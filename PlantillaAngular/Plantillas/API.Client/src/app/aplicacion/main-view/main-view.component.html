<div class="dashboard">
  <!-- Header -->
  <header class="dashboard-header">
    <div class="header-content">
      <div class="brand">
        <span class="brand-icon">üöÄ</span>
        <div class="brand-text">
          <h1>Panel de Portfolio</h1>
          <p>Aplicaci√≥n Full-Stack ‚Ä¢ Clean Architecture ‚Ä¢ GraphQL</p>
        </div>
      </div>
      
      <div class="header-stats" *ngIf="!isLoading() && projects().length > 0">
        <div class="stat-item">
          <span class="stat-value">{{ projects().length }}</span>
          <span class="stat-label">Proyectos</span>
        </div>
        <div class="stat-item">
          <span class="stat-value">{{ getTotalTasks() }}</span>
          <span class="stat-label">Total Tareas</span>
        </div>
        <div class="stat-item completed">
          <span class="stat-value">{{ getCompletedTasks() }}</span>
          <span class="stat-label">Completadas</span>
        </div>
        <div class="stat-item in-progress">
          <span class="stat-value">{{ getInProgressTasks() }}</span>
          <span class="stat-label">En Progreso</span>
        </div>
      </div>
    </div>
  </header>

  <!-- Notifications -->
  <div class="notifications">
    <div *ngIf="successMessage()" class="notification success">
      <span>‚úì</span> {{ successMessage() }}
    </div>
    <div *ngIf="errorMessage()" class="notification error">
      <span>‚ö†Ô∏è</span> {{ errorMessage() }}
      <button (click)="errorMessage.set(null)" class="close-btn">√ó</button>
    </div>
    <div *ngIf="isUpdating()" class="notification updating">
      <span class="spinner"></span> Actualizando...
    </div>
  </div>

  <!-- Loading State -->
  <div *ngIf="isLoading()" class="loading-state">
    <div class="loading-spinner"></div>
    <p>Cargando tu portfolio...</p>
  </div>

  <!-- Main Content -->
  <main *ngIf="!isLoading()" class="dashboard-main">
    <!-- Sidebar: Projects List -->
    <aside class="projects-sidebar">
      <div class="sidebar-header">
        <h2>üìÅ Proyectos</h2>
        <div class="sidebar-actions">
          <button class="add-btn" (click)="openCreateProjectDialog()" title="Nuevo proyecto">‚ûï</button>
          <button class="refresh-btn" (click)="loadProjects()" title="Actualizar">üîÑ</button>
        </div>
      </div>
      
      <div class="projects-list">
        <app-project-card 
          *ngFor="let project of projects()"
          [project]="project"
          [selected]="selectedProject()?.projectId === project.projectId"
          (selectProject)="selectProject($event)"
          (editProject)="openEditProjectDialog($event)"
          (deleteProject)="confirmDeleteProject($event)">
        </app-project-card>
        
        <div *ngIf="projects().length === 0" class="empty-projects">
          <span class="empty-icon">üì≠</span>
          <p>No se encontraron proyectos</p>
          <small>Haz clic en ‚ûï para crear uno nuevo</small>
          <button class="create-first-btn" (click)="openCreateProjectDialog()">
            ‚ûï Crear primer proyecto
          </button>
        </div>
      </div>
    </aside>

    <!-- Main: Kanban Board -->
    <section class="kanban-section">
      <div *ngIf="selectedProject()" class="project-header">
        <div class="project-info">
          <h2>{{ selectedProject()?.name }}</h2>
          <p>{{ selectedProject()?.description }}</p>
        </div>
        <div class="project-actions">
          <button mat-flat-button color="primary" (click)="openCreateTaskDialog(selectedProject()!)">
            <mat-icon>add</mat-icon>
            Nueva Tarea
          </button>
        </div>
      </div>
      
      <app-kanban-board 
        *ngIf="selectedProject()"
        [tasks]="selectedProject()?.tasks || []"
        (taskStatusChanged)="onTaskStatusChanged($event)"
        (editTask)="openEditTaskDialog($event)"
        (deleteTask)="confirmDeleteTask($event)">
      </app-kanban-board>
      
      <div *ngIf="!selectedProject() && projects().length > 0" class="select-project">
        <span class="select-icon">üëà</span>
        <p>Selecciona un proyecto para ver las tareas</p>
      </div>
    </section>
  </main>
</div>

<!-- Modal para crear proyecto -->
<div class="modal-overlay" *ngIf="showCreateModal()" (click)="closeCreateModal()">
  <div class="modal-content" (click)="$event.stopPropagation()">
    <div class="modal-header">
      <h2>‚ûï Nuevo Proyecto</h2>
      <button class="modal-close" (click)="closeCreateModal()">√ó</button>
    </div>
    
    <div class="modal-body">
      <div class="form-group">
        <label for="projectName">Nombre del proyecto *</label>
        <input 
          type="text" 
          id="projectName" 
          [(ngModel)]="newProjectName"
          placeholder="Ej: Mi aplicaci√≥n web"
          maxlength="200"
          [disabled]="isCreating()">
      </div>
      
      <div class="form-group">
        <label for="projectDescription">Descripci√≥n (opcional)</label>
        <textarea 
          id="projectDescription" 
          [(ngModel)]="newProjectDescription"
          placeholder="Describe brevemente el proyecto..."
          rows="3"
          maxlength="1000"
          [disabled]="isCreating()">
        </textarea>
      </div>
    </div>
    
    <div class="modal-footer">
      <button class="btn-cancel" (click)="closeCreateModal()" [disabled]="isCreating()">
        Cancelar
      </button>
      <button class="btn-create" (click)="createProject()" [disabled]="isCreating() || !newProjectName.trim()">
        <span *ngIf="isCreating()" class="spinner-small"></span>
        {{ isCreating() ? 'Creando...' : 'Crear Proyecto' }}
      </button>
    </div>
  </div>
</div>
